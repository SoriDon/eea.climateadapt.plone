<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  metal:use-macro="context/main_template/macros/master"
  i18n:domain="eea">

  <body>

    <metal:content-core fill-slot="content-core">

      <metal:block define-macro="content-core">

        <div tal:define="
          self nocall:context/@@faceted-climate-listing-view;
          folderContents folderContents | python:context.getFolderContents();
          all_results python:self.results(folderContents);
          sections self/sections;
          labels self/labels">

          <div class="listingBar" style="display: none"></div>

          <div tal:repeat="search_type sections">

            <tal:def tal:define="results python: all_results[search_type]">

              <div class="listing-result" tal:condition="results">
                <h3 tal:content="python: labels[search_type]" />
                <div class="table-control" tal:condition="nothing">
                  <strong>Sort by:</strong>

                  <input type="radio" name="" tal:attributes="name string:control-${search_type}; 
                    id string: search_relevance-control-${$search_type}" 
                    value="search_relevance" />
                  <label 
                    tal:attributes="for string: search_relevance-control-${$search_type}">
                    Search relevance
                  </label>

                  <input type="radio" name="" tal:attributes="name string:control-${search_type}; 
                    id string: atoz-control-${$search_type}" 
                    value="atoz" />
                  <label 
                    tal:attributes="for string: atoz-control-${$search_type}">A to Z</label>

                  <input type="radio" name="" tal:attributes="name string:control-${search_type}; 
                    id string: year-control-${$search_type}" 
                    value="year" />
                  <label 
                    tal:attributes="for string: year-control-${$search_type}">Year in descending order
                  </label>
                </div>

                <table class="listing-table" >
                  <thead>
                    <tr>
                      <th>Title</th>
                      <th>Relevance</th>
                      <th>Year</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr tal:repeat="brain results">
                      <td>
                        <h5><a href="" tal:content="brain/Title" tal:attributes="href brain/getURL">Link</a></h5>
                      </td>
                      <td tal:content="repeat/brain/index">relevance</td>
                      <td tal:content="brain/year">year</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </tal:def>
          </div>
          <script>
            $(document).ready(function() {
              jQuery(Faceted.Events).bind(Faceted.Events.AJAX_QUERY_SUCCESS, function(evt){
                console.log($('.listing-table'));
                // alert('success');
                console.log('success');
                $('.listing-table').DataTable(
                  {
                    paging: true,
                    pagingType: 'full',
                    pageLength: 10,
                    retrieve: true
                  }
                );
              });
            });
          </script>

        </div>

      </metal:block>
    </metal:content-core>
  </body>
</html>
