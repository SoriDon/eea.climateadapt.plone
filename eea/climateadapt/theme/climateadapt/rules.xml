<?xml version="1.0" encoding="UTF-8"?>
<rules
  xmlns="http://namespaces.plone.org/diazo"
  xmlns:css="http://namespaces.plone.org/diazo/css"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

  <theme href="index.html" css:if-content="#visual-portal-wrapper" />

  <!--Plone.app.toolbar-->
  <append theme="/html/body" content="//div[@data-iframe='toolbar']" />

  <!--Head-->
  <copy css:content="html" css:theme="html" attributes="lang dir" />
  <drop css:theme="head script" css:if-content=".template-sat"/>
  <before css:content="head style, head link, head script, head meta" css:theme-children="head" />
  <replace css:content="head title" css:theme="head title" />
  <copy css:content="head base" css:theme="head base" />
  <drop css:content="head link[rel='shortcut icon']" />
  <drop css:content="head link[rel='apple-touch-icon']" />

  <!--Content-->
  <merge attributes="class" css:content="body" css:theme="body" />
  <copy attributes="id dir" css:content="body" css:theme="body" />
  <copy attributes="role" css:content="content" css:theme="contentspace" />
  <replace css:content="#portal-columns" css:theme="#content" />

  <!--This is a work-around for a problem in plone.outputfilters html transformation
        Tickets: Refs #79364 / Refs #80564

        Basically you check if the href attribute of the <a> tag has 'resolveuid' in
        its composition, if it does you keep it like it is.

        If it doesn't then you copy the element as it is and you replace the 'href' attribute
        value with the value of 'data-val' attribute.
    -->
<!--     <xsl:template match="a">
      <xsl:choose>
        <xsl:when test="@data-val">
            <xsl:if test="contains(string(@href), 'resolveuid')">
                <a href="{@href}" data-val="{@data-val}" data-linktype="{@data-linktype}">
                    <xsl:value-of select="text()"/>
                </a>
            </xsl:if>
            <xsl:if test="not(contains(string(@href), 'resolveuid'))">
                <a>
                    <xsl:copy-of select="@*|b/@*" />
                    <xsl:attribute name="href">
                        <xsl:value-of select="@data-val" />
                    </xsl:attribute>
                    <xsl:apply-templates />
                </a>
            </xsl:if>
        </xsl:when>
        <xsl:otherwise>
          <xsl:copy>
            <xsl:apply-templates select="@*|node()"/>
          </xsl:copy>
        </xsl:otherwise>
        </xsl:choose>
    </xsl:template> -->

    <!--Viewlets-->
    <replace css:content="#portal-personaltools" css:theme="#user" />
    <copy attributes="href title" css:content="#portal-logo" css:theme="#logo a" />
    <replace css:content="#portal-header p.hiddenStructure" css:theme="#accessibility" />
    <drop css:content=".searchSection" />
    <replace css:content="#portal-searchbox" css:theme="#search" />

    <replace css:content="#navbar" css:theme="#mainnav" href="@@site_navbar" method="document" />

    <!-- <replace css:content="#portal&#45;globalnav li" css:theme&#45;children="#nav ul" /> -->
    <replace css:content-children="#portal-footer" css:theme="#footer-info" />
    <replace css:content="#portal-siteactions" css:theme-children="#siteactions" />
    <after css:content="#portal-languageselector" css:theme="#logo" />

    <!--Portlets-->
    <!-- Control Panel -->
    <after css:content="#visual-portal-wrapper .row:last-child script" css:theme="head script:last-child" />

    <!-- Puts the scripts after body, without this the google analytics -->
    <!-- script doesn't appear -->
    <!-- data-diazo="google-analytics" must be added to the script tag -->
    <after css:content="#visual-portal-wrapper script[data-diazo='google-analytics']" css:theme-children='body'/>
    <!-- <after css:content='#visual-portal-wrapper script' css:theme-children='body'/> -->

    <!-- Form fieldset fixes -->
    <!-- <before css:content&#45;children=".kssattr&#45;fieldset&#45;default"> -->
      <!--     <include css:content="#formfield&#45;form&#45;widgets&#45;IGeolocatable&#45;geolocation" /> -->
      <!-- </before> -->

  </rules>
